<!DOCTYPE html>
<html>
<head>
  <title>HellO2</title>
  <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css?family=Karla" rel="stylesheet">
</head>
<body>
  <div id="content">
    <div id='header'>
  
    </div>

    <div id='chat'>

    </div>
    <div id='inputContainer'> 
      <textarea id='input' rows="2" cols="30" onkeypress="handleKeyPress(event)"></textarea>
    </div>
  </div>

  <script type="text/javascript">
    function handleKeyPress(e){
     var key=e.keyCode || e.which;
      if (key==13){
        submit($('#input')[0].value);
        e.preventDefault();
        return false;
      }
    }

    function submit(text){
      console.log('sending: ' + text);
      add('user',text);
      $('#input')[0].value = ""; 
      $.post("/submit",{
        input: text,
        id: sessionId
      },
      function(response){
        console.log(response);
        if(response=='NO'){
          return;
        }

        add('bot',response);
      },
      'text'
      );

    }

      var sessionId = -1;

      function getId() {
        console.log("getting id");
        $.get("/id",function(data){
            sessionId = parseInt(data);
            console.log("session id: "+sessionId);
        })
         //  var aj = $.ajax({
         //  type: "GET",
         //  // contentType: "application/json",
         //  url: '/id',
         //  dataType: "text",
         //  succes : function(data){
         //    console.log(data);
         //    sessionId = parseInt(data);
         //    console.log("session id: "+sessionId);
         //  }, error: function(a,b,c){
         //     console.log(a);
         //     console.log(b);
         //     console.log(c);
         //  }
         // });   
      }

    function add(who,text){
      console.log('adding '+ text);
      var container = $('<div>').addClass('textContainer');
      var textBox = $('<div>').addClass('text').addClass(who).html(text).appendTo(container);
      container.appendTo($('#chat'));
        var chat    = $('#chat');
        chat.scrollTop(chat[0].scrollHeight);

      if(who=="user"){
                var avatar = $("<img>").attr("src","user-avatar.jpeg").addClass("avatar");
                avatar.appendTo(textBox);
            } else {
                var avatar = $("<img>").attr("src","bot-avatar.jpeg").addClass("avatar");
                avatar.appendTo(textBox);                
            }
    }

    getId();
    add("bot","Great that you are you! How do you want to help?");
    // submit("How are you?");
  </script>
</body>
</html>